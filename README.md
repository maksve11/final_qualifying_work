# final_qualifying_work
# üéØ Second Loan Prediction System (–í–ö–† ITMO, 2025)

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –≤–∑—è—Ç–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–æ–¥–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.**  
–ê–≤—Ç–æ—Ä: –ú–∞–∫—Å–∏–º –í–µ–ª–∏—á–∫–æ (ITMO, –§–ò–∏–ü, –≥—Ä. –ú34061)  
–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: –ê–ª–µ–∫—Å–µ–π –ó–∞–±–∞—à—Ç–∞, –∫.—Ç.–Ω., –¥–æ—Ü–µ–Ω—Ç –ò–¢–ú–û

---

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç end-to-end —Å–∏—Å—Ç–µ–º—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ç–æ–≥–æ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –ú–§–û –≤–µ—Ä–Ω—ë—Ç—Å—è –∑–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–π–º–æ–º –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–µ—Ä–≤–æ–≥–æ.  
–†–µ—à–µ–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ CatBoost –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–±—ã—Ç–∏–π.

üìä **–¶–µ–ª—å**: –ø–æ–≤—ã—Å–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–¥–µ—Ä–∂–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —É–≤–µ–ª–∏—á–∏—Ç—å LTV –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.

üìâ **–ú–µ—Ç—Ä–∏–∫–∏**:
- ROC AUC ‚âà 0.78
- F1-score ‚âà 0.75
- –ü—Ä–∏—Ä–æ—Å—Ç –≤—ã—Ä—É—á–∫–∏ (AB-—Ç–µ—Å—Ç) ‚Äî –¥–æ 15 –º–ª–Ω —Ä—É–±./–≥–æ–¥

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

![–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](./docs/architecture_diagram.png)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `EventSensor` ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Kafka-—Å–æ–±—ã—Ç–∏—è (–∑–∞–∫—Ä—ã—Ç–∏–µ –∑–∞–π–º–æ–≤), –∑–∞–ø—É—Å–∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
- `Inference Service` ‚Äî –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞, feature engineering, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ CatBoost-–º–æ–¥–µ–ª—å—é
- `DBWriter` ‚Äî –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ PostgreSQL
- `Prometheus + Grafana` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ **FastAPI**, –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ **Kafka**, —Ä–∞–±–æ—Ç–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

---

## üß† –ú–æ–¥–µ–ª—å

–ê–ª–≥–æ—Ä–∏—Ç–º: `CatBoostClassifier`  
–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- >250 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—Å–æ—Ü–∏–æ–¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ, –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ, –∞–Ω—Ç–∏—Ñ—Ä–æ–¥, –ë–ö–ò)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –ø—Ä–æ–ø—É—Å–∫–∞–º
- –û–±—É—á–µ–Ω–∏–µ —Å Time Series Split (gap)
- –ü–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ Optuna

---

## üß± –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø—Ä–∏–∑–Ω–∞–∫–∏

–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –∏–∑ 3 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- **BKI** (XML): –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–æ—Å—Ä–æ—á–∫–∏, –∑–∞–∫—Ä—ã—Ç—ã–µ —Å—á–µ—Ç–∞
- **Telecom API** (JSON): –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å SIM, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **Antifraud** (JSON): —Ñ–ª–∞–≥–∏ TOR, Remote Access, –±–æ—Ç–Ω–µ—Ç-–º–∞—Ä–∫–µ—Ä—ã

üõ†Ô∏è –ü–æ—Å–ª–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —á–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
- `max_days_overdue_last_12m`
- `sim_lifetime_days`
- `num_high_risk_flags`
- `avg_payment_ratio_by_type`, –∏ –¥—Ä.

---

## üß™ Offline –∏ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –º–æ–¥–µ–ª—å –ø—Ä–æ—Ö–æ–¥–∏–ª–∞ —Ç–µ–Ω–µ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (offline inference). –î–∞–ª–µ–µ ‚Äî A/B —Ç–µ—Å—Ç —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤:

- **–ì—Ä—É–ø–ø–∞ A** ‚Äî –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **–ì—Ä—É–ø–ø–∞ B** ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –º–æ–¥–µ–ª–∏

üìà –≠—Ñ—Ñ–µ–∫—Ç:
- +10‚Äì15% –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–π–º–æ–≤
- ‚àí20% –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∑–∞—Ç—Ä–∞—Ç
- +13 –º–ª–Ω —Ä—É–±. / –≥–æ–¥ —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Dev Mode)

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/<your-username>/second-loan-predictor.git
cd second-loan-predictor

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ inference-—Å–µ—Ä–≤–∏—Å–∞
uvicorn app.inference_service:app --reload

# –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
curl -X POST http://localhost:8000/predict -d '{"client_id": "123", "loan_id": "abc"}'

